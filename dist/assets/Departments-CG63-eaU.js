import{_ as H,m as K,r as $,c as k,a as C,o as m,b as a,t as p,u as n,d as l,i as M,w as c,f,g as v,E as g,e as G,F as J,k as P,N as L,q as Q,n as T,h as X,V as Y,W as Z,y as ee}from"./index-D0Jc_NLw.js";import{u as te}from"./departmentStore-Cyv-aTeW.js";import{u as se}from"./filterStore-BpegOwCG.js";const ae={class:"page-wrapper"},ne={class:"header-row"},le={class:"page-title"},oe={class:"header-actions"},re={class:"filter-section"},de={class:"departments-grid"},ce={class:"card-content"},ie={class:"card-row-two-cols first-row"},ue={class:"left-section"},pe={class:"value"},me={class:"right-section"},fe={class:"value"},ve={class:"card-row-two-cols"},ge={class:"left-section"},ye={class:"bays-wrapper"},_e={class:"bays-first-line"},he={key:0,class:"bays-expanded"},xe={class:"right-section"},be={class:"value-large"},Ce={class:"button-row"},we={__name:"Departments",setup(Be){const D=K(),r=te(),A=se(),y=$(""),_=k({get:()=>A.selectedCategory,set:s=>A.setCategory(s)}),N=k(()=>r.departments),F=s=>{const e=I.value[s],t=r.departments.findIndex(d=>d===e);t!==-1&&(r.departments[t].expanded=!r.departments[t].expanded)},E=s=>s?s.length>25:!1,R=s=>!s||s.length<=25?s:s.substring(0,25)+"...",I=k(()=>{let s=[...N.value];if(_.value&&(s=s.filter(e=>e.category===_.value)),y.value.trim()){const e=y.value.toLowerCase().trim();s=s.filter(t=>t.name.toLowerCase().includes(e)||t.assignedBays.includes(e)||t.devices.includes(e))}return s}),V=$(null),U=()=>{var s;(s=V.value)==null||s.click()},W=async s=>{const e=s.target.files[0];if(!e)return;const t=new FileReader;t.onload=d=>{var o,h,i,S;try{const w=d.target.result;if(e.name.endsWith(".csv")){const B=w.split(`
`),x=[];for(let u=1;u<B.length;u++)if(B[u].trim()){const b=B[u].split(",");x.push({name:((o=b[0])==null?void 0:o.trim())||"",assignedBays:((h=b[1])==null?void 0:h.trim())||"",devices:((i=b[2])==null?void 0:i.trim())||"",category:((S=b[3])==null?void 0:S.trim())||"A1"})}x.length>0&&(r.departments.length=0,x.forEach(u=>r.addDepartment(u)),alert(`成功导入 ${x.length} 条数据`))}else(e.name.endsWith(".xlsx")||e.name.endsWith(".xls"))&&alert("Excel 文件导入需要安装 xlsx 库。请使用 CSV 格式或安装 xlsx 库。")}catch(w){console.error("导入失败:",w),alert("文件导入失败，请检查文件格式")}},t.readAsText(e),s.target.value=""},q=()=>{const s="Department,Assigned Bays,Bays Total,Category",e=r.departments.map(i=>`${i.name},${i.assignedBays},${i.devices},${i.category}`),t=[s,...e].join(`
`),d=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a"),h=URL.createObjectURL(d);o.setAttribute("href",h),o.setAttribute("download",`departments_${new Date().getTime()}.csv`),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o),alert("数据导出成功")},j=()=>{D.push({path:"/Departments_all_edit",query:{mode:"add"}})},O=s=>{const e=r.departments.findIndex(t=>t===s);console.log("Editing department:",s),console.log("Department index:",e),D.push({path:"/Departments_all_edit",query:{mode:"edit",index:e}})},z=s=>{ee.confirm(`Are you sure you want to delete ${s.name}?`,"Confirm Delete",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"confirm-delete-btn",cancelButtonClass:"cancel-delete-btn"}).then(()=>{const e=r.departments.findIndex(t=>t.name===s.name&&t.locker===s.locker&&t.assignedBays===s.assignedBays);e!==-1&&(r.deleteDepartment(e),alert("Department deleted successfully"))}).catch(()=>{console.log("Delete cancelled")})};return(s,e)=>(m(),C("div",ae,[a("div",ne,[a("h1",le,"Departments ("+p(n(r).departments.length)+")",1),a("div",oe,[l(n(M),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"Search","prefix-icon":"el-icon-search",class:"search-input"},null,8,["modelValue"]),l(n(v),{class:"import-btn",onClick:U},{default:c(()=>[...e[2]||(e[2]=[f("Import File",-1)])]),_:1}),a("input",{ref_key:"fileInput",ref:V,type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},onChange:W},null,544),l(n(v),{class:"export-btn",onClick:q},{default:c(()=>[...e[3]||(e[3]=[f("Export File",-1)])]),_:1}),l(n(v),{type:"primary",class:"add-dept-btn",onClick:j},{default:c(()=>[...e[4]||(e[4]=[f("Add New Department",-1)])]),_:1})])]),a("div",re,[l(n(G),{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:c(()=>[l(n(g),{label:"All Categories",value:""}),l(n(g),{label:"A1",value:"A1"}),l(n(g),{label:"A2",value:"A2"}),l(n(g),{label:"A3",value:"A3"}),l(n(g),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),a("div",de,[(m(!0),C(J,null,P(I.value,(t,d)=>(m(),C("div",{key:d,class:"dept-card-wrapper"},[l(n(Z),{class:"dept-card"},{default:c(()=>[a("div",ce,[a("div",ie,[a("div",ue,[e[5]||(e[5]=a("p",{class:"label"},"Department",-1)),a("p",pe,p(t.name),1)]),a("div",me,[e[6]||(e[6]=a("p",{class:"label"},"Locker",-1)),a("p",fe,p(t.locker),1)])]),a("div",ve,[a("div",ge,[e[7]||(e[7]=a("p",{class:"label"},"Assigned Bays",-1)),a("div",ye,[a("div",_e,[a("p",{class:T(["value bays-value",{expanded:t.expanded}])},p(t.expanded?t.assignedBays:R(t.assignedBays)),3),E(t.assignedBays)?(m(),Q(n(X),{key:0,class:T(["expand-icon",{expanded:t.expanded}]),onClick:o=>F(d)},{default:c(()=>[l(n(Y))]),_:1},8,["class","onClick"])):L("",!0)]),t.expanded&&E(t.assignedBays)?(m(),C("div",he,p(t.assignedBays),1)):L("",!0)])]),a("div",xe,[e[8]||(e[8]=a("p",{class:"label"},"Bays Total",-1)),a("p",be,p(t.devices),1)])]),a("div",Ce,[l(n(v),{class:"edit-btn",onClick:o=>O(t,d)},{default:c(()=>[...e[9]||(e[9]=[f("Edit",-1)])]),_:1},8,["onClick"]),l(n(v),{class:"delete-btn",onClick:o=>z(t,d)},{default:c(()=>[...e[10]||(e[10]=[f("Delete",-1)])]),_:1},8,["onClick"])])])]),_:2},1024)]))),128))])]))}},Ee=H(we,[["__scopeId","data-v-fcc454c3"]]);export{Ee as default};
