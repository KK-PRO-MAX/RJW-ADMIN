import{_ as X,H as Z,r as g,c as q,o as ee,v as ae,x as te,a6 as le,a as h,b as y,d as l,Y as se,t as v,e as d,u as o,j as re,w as u,g as p,h as f,E as w,f as oe,C as de,M as m,n as z,N as ce,F as ne,l as ie,O as D,m as i,G as ue}from"./index-B_Ky5Mco.js";import{u as ve}from"./userStore-vqW6dvip.js";import{u as pe}from"./filterStore-BRLp2vDi.js";import{g as fe,d as me}from"./user-DZDS1ZP8.js";import{g as ge}from"./locker-BJ-e9BM6.js";import"./index-B9ygI19o.js";const ye={class:"users-page"},_e={class:"header-row"},be={class:"page-title"},he={class:"header-actions"},we={class:"filter-section"},ke={class:"name-with-status"},Ce={class:"user-cards mobile-cards"},Se={class:"card-row data-row"},Ee={class:"card-cell"},Ie={class:"cell-value name-with-status"},Ae={class:"card-cell"},Ue={class:"cell-value"},xe={class:"card-row data-row"},De={class:"card-cell"},Le={class:"cell-value"},Fe={class:"card-cell"},Ne={class:"cell-value"},Ve={class:"card-row data-row"},Be={class:"card-cell"},Oe={class:"cell-value"},$e={class:"card-cell"},Re={class:"cell-value"},Te={class:"card-row data-row"},je={class:"card-cell action-cell",style:{"grid-column":"1 / -1"}},Me={class:"cell-value"},qe={class:"action-buttons"},ze=Object.assign({name:"Users"},{__name:"Users",setup(Je){const A=Z(),L=ve(),F=pe(),U=g([]),_=g([]),k=g(!1),N=g(0),C=g(""),S=q({get:()=>F.selectedCategory,set:t=>F.setCategory(t)}),J={backgroundColor:"#C7EDFF",color:"#000",fontWeight:"bold"},E=q(()=>{let t=[...U.value];if(S.value&&(t=t.filter(a=>a.category===S.value)),C.value){const a=C.value.toLowerCase();t=t.filter(s=>Object.entries(s).some(([e,r])=>e!=="category"&&r&&r.toString().toLowerCase().includes(a)))}return t}),V={0:"Temporary",1:"Full Time",2:"Manager",3:"Admin",4:"Factory Admin",5:"Super Admin",6:"Supervisor"},B={0:"Inactive",1:"Active",2:"Pending"},x=async()=>{try{console.log("开始请求Locker列表...");const t=await ge();t.data.ret===0&&(t.data.code===200||t.data.code==="200")?(_.value=t.data.ret_data||[],console.log("✓ Locker列表加载成功，共",_.value.length,"条")):(console.error("✗ Locker列表API返回错误:",t.data),_.value=[])}catch(t){console.error("获取Locker列表失败:",t),_.value=[]}},I=async()=>{k.value=!0;try{console.log("开始请求用户数据接口...");const t=await fe();if(console.log("接口返回完整数据:",t.data),t.data.ret===0&&(t.data.code===200||t.data.code==="200")){const a=t.data.ret_data;let s=a;if(typeof a=="string")try{s=JSON.parse(a)}catch(e){console.error("解析用户数据失败:",e),i.error("Failed to parse user data"),k.value=!1;return}console.log("接口返回用户列表:",s),U.value=s.map(e=>{const r=_.value.find(n=>n===e.locker),c=(r==null?void 0:r.name)||(e.locker!==void 0?` ${e.locker}`:"");return{id:e.id,name:e.name||`${e.user_first_name||e["user first name"]||""} ${e.user_last_name||e["user last name"]||""}`.trim()||"Unknown",employeeId:e.employee_id!==void 0||e.employee_id!==void 0?e.employee_id.toString():"",badgeId:e.user_badge_id!==void 0?e.user_badge_id.toString():e["user badge_id"]!==void 0?e["user badge_id"].toString():"",locker:c,locker_id:e.locker_id,role:V[e.role_id]||V[e.role_id]||`Role ${e.role_id||e.role_id||""}`,status:B[e.status]||B[e.status]||`Status ${e.status||e.status||""}`,category:"",employmentStatus:e.status===1||e.status===1?"active":"inactive",originalData:e}}),console.log("转换后的数据:",U.value),N.value++}else console.error("接口返回错误状态:",t.data),i.error(t.data.msg||"Failed to fetch data")}catch(t){console.error("接口请求失败:",t),i.error(`Request failed: ${t.message||"Network error"}`)}finally{k.value=!1}},O=g(null),H=()=>{O.value.click()},P=t=>{const a=t.target.files[0];if(!a)return;const s=new FileReader;a.name.endsWith(".csv")?(s.onload=e=>{const r=e.target.result,c=W(r);c&&(L.userList=c,t.target.value="")},s.readAsText(a)):a.name.endsWith(".json")?(s.onload=e=>{try{const r=JSON.parse(e.target.result);Array.isArray(r)?(L.userList=r,t.target.value=""):i.error("Invalid JSON format. Expected an array.")}catch(r){i.error("Error parsing JSON file: "+r.message)}},s.readAsText(a)):i.error("Unsupported file format. Please upload CSV or JSON.")},W=t=>{try{const a=t.split(`
`).filter(n=>n.trim());if(a.length<2)return i.error("CSV file is empty or has no data."),null;const s=a[0].split(",").map(n=>n.trim()),e=["name","employeeId","badgeId","locker","role","status"],r=e.filter(n=>!s.some(b=>b.toLowerCase()===n));if(r.length>0)return i.error(`CSV file is missing required columns: ${r.join(", ")}`),null;const c=[];for(let n=1;n<a.length;n++){const b=a[n].split(","),T={};s.forEach((Q,Y)=>{var M;const j=Q.toLowerCase();e.includes(j)&&(T[j]=((M=b[Y])==null?void 0:M.trim())||"")}),c.push(T)}return c}catch(a){return i.error("Error parsing CSV file: "+a.message),null}},G=()=>{const t=E.value,a=["name","employeeId","badgeId","locker","role","status"],s=[a.join(","),...t.map(n=>a.map(b=>n[b]||"").join(","))].join(`
`),e=new Blob([s],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(e),c=document.createElement("a");c.href=r,c.download="users_export.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c)},K=()=>{A.push({name:"Users_all_edit",query:{mode:"add"}})},$=t=>{A.push({path:"/Users_all_edit",query:{mode:"edit",id:t.id,name:t.name,employeeId:t.employeeId,badgeId:t.badgeId,locker:t.locker,role:t.role,status:t.status,category:t.category||"",employmentStatus:t.employmentStatus||"active"}})},R=async t=>{var a;try{if(await ue.confirm(`Are you sure you want to delete user ${t.name}? This action cannot be undone.`,"Confirm Deletion",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning"})==="confirm"){const e=await me({id:t.id});if(e.data&&(e.data.ret===0||e.data.code===200||e.data.code==="200"))i.success("User deleted successfully"),I();else throw new Error(((a=e.data)==null?void 0:a.msg)||"Failed to delete user")}}catch(s){s==="cancel"?i.info("Deletion cancelled"):(console.error("删除用户出错:",s),i.error(s.message||"Failed to delete user"))}};return ee(async()=>{await x(),await I()}),ae(async()=>{await x(),await I()}),te(()=>A.currentRoute.value,async(t,a)=>{a.path&&a.path.includes("Users_all_edit")&&t.name==="Users"&&(await x(),await I())}),(t,a)=>{const s=le("loading");return y(),h("div",ye,[l("div",_e,[l("h1",be,"Users ("+v(E.value.length)+")",1),l("div",he,[d(o(re),{modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"Search",style:{width:"200px"},clearable:""},null,8,["modelValue"]),d(o(f),{class:"import-btn",onClick:H},{default:u(()=>[...a[2]||(a[2]=[p(" Import File ",-1)])]),_:1}),d(o(f),{class:"export-btn",onClick:G},{default:u(()=>[...a[3]||(a[3]=[p(" Export File ",-1)])]),_:1}),d(o(f),{type:"primary",class:"add-user-btn",onClick:K},{default:u(()=>[...a[4]||(a[4]=[p("Add New User",-1)])]),_:1}),l("input",{ref_key:"fileInput",ref:O,type:"file",style:{display:"none"},accept:".csv,.json",onChange:P},null,544)])]),l("div",we,[d(o(oe),{modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=e=>S.value=e),placeholder:"All Categories",clearable:"",style:{width:"200px"}},{default:u(()=>[d(o(w),{label:"All Categories",value:""}),d(o(w),{label:"A1",value:"A1"}),d(o(w),{label:"A2",value:"A2"}),d(o(w),{label:"A3",value:"A3"}),d(o(w),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),se((y(),de(o(ce),{key:N.value,data:E.value,border:"","header-cell-style":J,class:"users-table desktop-table"},{default:u(()=>[d(o(m),{prop:"name",label:"Name"},{default:u(e=>[l("div",ke,[(y(),h("svg",{class:z(["status-icon",e.row.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...a[5]||(a[5]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,v(e.row.name),1)])]),_:1}),d(o(m),{prop:"employeeId",label:"Employee ID"}),d(o(m),{prop:"badgeId",label:"Badge ID"}),d(o(m),{prop:"locker",label:"Locker"}),d(o(m),{prop:"role",label:"Role"}),d(o(m),{prop:"status",label:"Status"}),d(o(m),{label:"Operation",align:"center"},{default:u(e=>[d(o(f),{type:"primary",plain:"",class:"edit-btn",onClick:r=>$(e.row)},{default:u(()=>[...a[6]||(a[6]=[p(" Edit ",-1)])]),_:1},8,["onClick"]),d(o(f),{type:"danger",plain:"",class:"delete-btn",onClick:r=>R(e.row)},{default:u(()=>[...a[7]||(a[7]=[p(" Delete ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[s,k.value]]),l("div",Ce,[(y(!0),h(ne,null,ie(E.value,(e,r)=>(y(),h("div",{key:r,class:"user-card"},[a[14]||(a[14]=D('<div class="card-row header-row-card" data-v-f21923dc><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Name</div></div><div class="card-divider-vertical" data-v-f21923dc></div><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Employee ID</div></div></div>',1)),l("div",Se,[l("div",Ee,[l("div",Ie,[(y(),h("svg",{class:z(["status-icon",e.employmentStatus==="active"?"status-active":"status-inactive"]),viewBox:"0 0 24 24",fill:"currentColor"},[...a[8]||(a[8]=[l("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"},null,-1)])],2)),l("span",null,v(e.name),1)])]),a[9]||(a[9]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Ae,[l("div",Ue,v(e.employeeId),1)])]),a[15]||(a[15]=D('<div class="card-row header-row-card" data-v-f21923dc><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Badge ID</div></div><div class="card-divider-vertical" data-v-f21923dc></div><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Locker</div></div></div>',1)),l("div",xe,[l("div",De,[l("div",Le,v(e.badgeId),1)]),a[10]||(a[10]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",Fe,[l("div",Ne,v(e.locker),1)])]),a[16]||(a[16]=D('<div class="card-row header-row-card" data-v-f21923dc><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Role</div></div><div class="card-divider-vertical" data-v-f21923dc></div><div class="card-cell" data-v-f21923dc><div class="cell-label" data-v-f21923dc>Status</div></div></div>',1)),l("div",Ve,[l("div",Be,[l("div",Oe,v(e.role),1)]),a[11]||(a[11]=l("div",{class:"card-divider-vertical"},null,-1)),l("div",$e,[l("div",Re,v(e.status),1)])]),a[17]||(a[17]=l("div",{class:"card-row header-row-card"},[l("div",{class:"card-cell",style:{"grid-column":"1 / -1"}},[l("div",{class:"cell-label"},"Operation")])],-1)),l("div",Te,[l("div",je,[l("div",Me,[l("div",qe,[d(o(f),{type:"primary",plain:"",class:"edit-btn-mobile",onClick:c=>$(e)},{default:u(()=>[...a[12]||(a[12]=[p(" Edit ",-1)])]),_:1},8,["onClick"]),d(o(f),{type:"danger",plain:"",class:"delete-btn-mobile",onClick:c=>R(e)},{default:u(()=>[...a[13]||(a[13]=[p(" Delete ",-1)])]),_:1},8,["onClick"])])])])])]))),128))])])}}}),Ye=X(ze,[["__scopeId","data-v-f21923dc"]]);export{Ye as default};
