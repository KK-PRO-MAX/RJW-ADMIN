import{_ as oe,B as ne,H as de,r as i,c as h,o as re,m as k,z as x,a as _,b as c,d as a,e as d,w as n,u as ie,I as ue,t as S,F as $,l as I,C as M,g as u,y as ce,n as R}from"./index-B_Ky5Mco.js";import{u as me}from"./departmentStore-BPlMtrNl.js";import"./index-B9ygI19o.js";const ve={class:"edit-page"},pe={class:"page-header"},fe={class:"page-title"},ge={class:"form-section"},ye={class:"form-section"},ke={class:"form-section"},_e={class:"section-with-button"},be={class:"tags-container"},Be={class:"section-with-button"},De={class:"tags-container"},Ce={class:"form-section"},Ue={class:"footer-buttons"},Ve={class:"card-grid"},we=["onClick"],xe={class:"dialog-footer"},Se={class:"card-grid"},Ae=["onClick"],Ne={class:"dialog-footer"},$e={__name:"Departments_all_edit",setup(Ie){const E=ne(),A=de(),b=me(),N=i(""),T=h(()=>r.value.length>0?r.value.length.toString():N.value),B=i(!1),m=i(-1),j=h(()=>B.value?"Edit Department":"Add New Department"),p=i(""),D=i(""),C=i(""),U=i(!1),V=i(!1),f=i([]),g=i([]),w=i(!1),r=i([]),y=i([]),z=i([{id:"u1",name:"User 1"},{id:"u2",name:"User 2"},{id:"u3",name:"User 3"},{id:"u4",name:"User 4"},{id:"u5",name:"User 5"}]),H=i(Array.from({length:100},(o,e)=>({id:`bay${e+1}`,name:`Bay ${e+1}`})));re(()=>{const o=E.query.mode;if(B.value=o==="edit",console.log("Route query:",E.query),console.log("History state:",history.state),B.value){m.value=parseInt(E.query.index);let e=null;if(m.value>=0&&b.departments[m.value]?(e=b.departments[m.value],console.log("Loading data from store:",e)):history.state.deptData&&(e=history.state.deptData,console.log("Loading data from history state:",e)),console.log("Edit mode - Department Data:",e),e){if(p.value=e.name||"",D.value=e.locker||"",C.value=e.detail||"",N.value=e.devices||"",console.log("Loaded name:",p.value),console.log("Loaded locker:",D.value),console.log("Loaded description:",C.value),console.log("assignedBays string:",e.assignedBays),console.log("devices:",e.devices),e.assignedBays){const l=e.assignedBays.split(",").map(s=>s.trim()).filter(s=>s);console.log("Bay numbers:",l),r.value=l.map(s=>({id:`bay${s}`,name:`Bay ${s}`})),console.log("Loaded Assigned Bays:",r.value)}}else console.warn("No department data found"),k.warning("Failed to load department data")}});const P=()=>{A.push("/Departments")},G=async()=>{if(!p.value.trim()){k.warning("Please enter a department name");return}const o=r.value.map(s=>s.name.replace("Bay ","")).join(", "),e=f.value.map(s=>s.id).join(",");let l=null;if(B.value&&m.value>=0&&(l=b.departments[m.value]),B.value&&m.value>=0){const s={id:(l==null?void 0:l.id)||0,name:p.value.trim(),locker:D.value.trim(),detail:C.value.trim(),user_list:e||(l==null?void 0:l.user_list)||"",assignedBays:o,devices:r.value.length>0?r.value.length.toString():N.value,category:(l==null?void 0:l.category)||"A1",expanded:(l==null?void 0:l.expanded)||!1};try{await b.editDepartment(s),k.success("Department updated successfully"),A.push("/Departments")}catch(v){k.error("Failed to update department: "+(v.message||"Unknown error"));return}}else{const s={name:p.value.trim(),locker:D.value.trim(),detail:C.value.trim(),user_list:e||"",assignedBays:o,devices:r.value.length>0?r.value.length.toString():N.value,category:"A1"};try{await b.addDepartment(s),k.success("Department added successfully"),A.push("/Departments")}catch(v){k.error("Failed to add department: "+(v.message||"Unknown error"));return}}},J=()=>{U.value=!1,m.value>=0&&(b.deleteDepartment(m.value),k.success("Department deleted successfully")),A.push("/Departments")},K=o=>{const e=f.value.findIndex(l=>l.id===o.id);e>-1&&f.value.splice(e,1)},O=o=>g.value.some(e=>e.id===o.id),Q=o=>{const e=g.value.findIndex(l=>l.id===o.id);e>-1?g.value.splice(e,1):g.value.push(o)},W=()=>{f.value=[...g.value],V.value=!1},X=()=>{V.value=!1,g.value=[...f.value]},Y=()=>{g.value=[...f.value],V.value=!0},Z=o=>{const e=r.value.findIndex(l=>l.id===o.id);e>-1&&r.value.splice(e,1)},ee=o=>y.value.some(e=>e.id===o.id),te=o=>{const e=y.value.findIndex(l=>l.id===o.id);e>-1?y.value.splice(e,1):y.value.push(o)},le=()=>{r.value=[...y.value],w.value=!1},se=()=>{w.value=!1,y.value=[...r.value]},ae=()=>{y.value=[...r.value],w.value=!0};return(o,e)=>{const l=x("el-icon"),s=x("el-button"),v=x("el-input"),q=x("el-tag"),L=x("el-dialog");return c(),_("div",ve,[a("div",pe,[d(s,{type:"text",class:"back-btn",onClick:P},{default:n(()=>[d(l,null,{default:n(()=>[d(ie(ue))]),_:1})]),_:1}),a("h1",fe,S(j.value),1),e[9]||(e[9]=a("div",{class:"header-spacer"},null,-1))]),e[27]||(e[27]=a("p",{class:"page-description"},"Assign User to Assigned department.",-1)),a("div",ge,[e[10]||(e[10]=a("label",{class:"form-label"},"Department",-1)),d(v,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:"Enter department name",class:"department-name-input"},null,8,["modelValue"])]),a("div",ye,[e[11]||(e[11]=a("label",{class:"form-label"},"Locker",-1)),d(v,{modelValue:D.value,"onUpdate:modelValue":e[1]||(e[1]=t=>D.value=t),placeholder:"Enter locker name",class:"locker-name-input"},null,8,["modelValue"])]),a("div",ke,[e[12]||(e[12]=a("label",{class:"form-label"},"Department Description",-1)),d(v,{modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=t=>C.value=t),type:"textarea",rows:3,placeholder:"Enter department description",class:"department-description-input"},null,8,["modelValue"])]),a("div",_e,[e[14]||(e[14]=a("label",{class:"form-label"},"User",-1)),a("div",be,[(c(!0),_($,null,I(f.value,t=>(c(),M(q,{key:t.id,closable:"",class:"item-tag",onClose:F=>K(t)},{default:n(()=>[u(S(t.name),1)]),_:2},1032,["onClose"]))),128))]),d(s,{type:"primary",class:"add-manage-btn",onClick:Y},{default:n(()=>[...e[13]||(e[13]=[u(" Add Manage ",-1)])]),_:1})]),a("div",Be,[e[16]||(e[16]=a("label",{class:"form-label"},"Assigned Bays",-1)),a("div",De,[(c(!0),_($,null,I(r.value,t=>(c(),M(q,{key:t.id,closable:"",class:"item-tag",onClose:F=>Z(t)},{default:n(()=>[u(S(t.name),1)]),_:2},1032,["onClose"]))),128))]),d(s,{type:"primary",class:"add-manage-btn",onClick:ae},{default:n(()=>[...e[15]||(e[15]=[u(" Add Manage ",-1)])]),_:1})]),a("div",Ce,[e[17]||(e[17]=a("label",{class:"form-label"},"Bays Total",-1)),d(v,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value=t),readonly:"",class:"bays-total-input"},null,8,["modelValue"])]),a("div",Ue,[d(s,{class:"save-btn-bottom",onClick:G},{default:n(()=>[...e[18]||(e[18]=[u("Save",-1)])]),_:1}),B.value?(c(),M(s,{key:0,class:"delete-btn",onClick:e[4]||(e[4]=t=>U.value=!0)},{default:n(()=>[...e[19]||(e[19]=[u("Delete",-1)])]),_:1})):ce("",!0)]),d(L,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=t=>V.value=t),title:"Select Users",width:"700px",color:"#000","close-on-click-modal":!1,"custom-class":"custom-selection-dialog",style:{"font-weight":"600"}},{footer:n(()=>[a("span",xe,[d(s,{type:"default",class:"cancel-btn",onClick:X},{default:n(()=>[...e[20]||(e[20]=[u("Cancel",-1)])]),_:1}),d(s,{type:"primary",class:"save-btn",onClick:W},{default:n(()=>[...e[21]||(e[21]=[u("Save",-1)])]),_:1})])]),default:n(()=>[a("div",Ve,[(c(!0),_($,null,I(z.value,t=>(c(),_("div",{key:t.id,class:R(["selection-card",{selected:O(t)}]),onClick:F=>Q(t)},S(t.name),11,we))),128))])]),_:1},8,["modelValue"]),d(L,{modelValue:w.value,"onUpdate:modelValue":e[6]||(e[6]=t=>w.value=t),title:"Select Assigned Bays",width:"700px",color:"#000","close-on-click-modal":!1,"custom-class":"custom-selection-dialog",style:{"font-weight":"600"}},{footer:n(()=>[a("span",Ne,[d(s,{type:"default",class:"cancel-btn",onClick:se},{default:n(()=>[...e[22]||(e[22]=[u("Cancel",-1)])]),_:1}),d(s,{type:"primary",class:"save-btn",onClick:le},{default:n(()=>[...e[23]||(e[23]=[u("Save",-1)])]),_:1})])]),default:n(()=>[a("div",Se,[(c(!0),_($,null,I(H.value,t=>(c(),_("div",{key:t.id,class:R(["selection-card",{selected:ee(t)}]),onClick:F=>te(t)},S(t.name),11,Ae))),128))])]),_:1},8,["modelValue"]),d(L,{modelValue:U.value,"onUpdate:modelValue":e[8]||(e[8]=t=>U.value=t),title:"Confirm Delete",width:"400px"},{footer:n(()=>[d(s,{onClick:e[7]||(e[7]=t=>U.value=!1)},{default:n(()=>[...e[24]||(e[24]=[u("Cancel",-1)])]),_:1}),d(s,{type:"danger",onClick:J},{default:n(()=>[...e[25]||(e[25]=[u("Delete",-1)])]),_:1})]),default:n(()=>[e[26]||(e[26]=a("p",null,"Are you sure you want to delete this department?",-1))]),_:1},8,["modelValue"])])}}},Me=oe($e,[["__scopeId","data-v-c91c9636"]]);export{Me as default};
